# 事务
## 概述
- 用于处理操作量大、复杂度高的数据

## 条件
- 事务必须满足4个条件
	- A
		- 原子性(不可分割性)
			- 事务中的所有操作要么全部完成，要么全部不完成
				- 执行的执行若发生错误，会被回滚到开始前的状态
	- C
		- 一致性
			- 事务开始之前和事务结束之后，数据库的完整性没有被破坏
	- I
		- 隔离性
			- 数据库允许多个并发事务同时对其数据进行操作
			- 隔离性可以防止多个事务并发执行时
				- 由于交叉执行而导致数据的不一致
		- 隔离级别
			- 未提交读
				- 事务A可以读事务B未提交的数据
				- 脏读
					- 一个事务读取了另外一个事务未提交的数据

			- 提交读
				- 不可重复读
					- 一个事务内，两次查询，结果却不一样 
				- 

			- 重复读
				- 同一个事务的多个实例在并发读数据的时候，会看到相同的数据行
				- 幻读
					- 读取某一范围的数据行时，另一个事务又在改范围内插入了新的记录，当用户再读取时，就会发现新的幻影

			- 序列化
				- 强制事务排序，使之不能相互冲突
				- 它是在每个读的数据行上加上共享锁
	- D
		- 持久性
			- 事务处理结束后，对数据的修改就是永久的

## 原理
- 事务的隔离，通常是通过锁来实现的
- 两种不同的实现事务锁
	- 悲观锁
	    - 缺点
		    - 资源从它第一次被访问时就锁上，直到事务结束
			    - 对其它事务不可访问
		- 锁以一种安全失败的方式被应用   
			- 当访问一个被上锁的资源，当前事务会被延迟或者回滚 

	- 乐观锁
		- 当一个资源第一次被访问时，资源实际上被没有被锁	
			- 取代地是，当资源本该被悲观锁定方法锁定的状态被保存
		- 其它的事务可以并发地访问	资源并且冲突变化的可能性是可能的
		- 在提交时间，当资源在一个持久存储里被更新的时候，资源的状态再一次从存储里读取
			- 并且和资源第一次被访问时保存的状态比较
			- 如果两个状态不同，一个更新冲突产生，事务将会被回滚